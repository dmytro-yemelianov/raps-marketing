<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APS OAuth Scope Builder Tool</title>
    <meta name="description" content="Interactive tool to build and validate Autodesk Platform Services (APS) OAuth scope combinations">
    <meta name="keywords" content="APS, OAuth, scopes, permissions, authentication, builder, Autodesk">
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .auth-type-selector {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .auth-type-selector h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .auth-type-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .auth-btn {
            padding: 12px 24px;
            border: 2px solid #ffc107;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .auth-btn.active {
            background: #ffc107;
            color: #000;
        }
        
        .auth-btn:hover {
            background: #ffc107;
            color: #000;
        }
        
        .scope-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .scope-category {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #facc15;
        }
        
        .scope-category h3 {
            margin-top: 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .scope-item {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            padding: 10px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .scope-item:hover {
            background: white;
        }
        
        .scope-checkbox {
            margin-right: 12px;
            margin-top: 3px;
            transform: scale(1.2);
        }
        
        .scope-details {
            flex: 1;
        }
        
        .scope-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 4px;
        }
        
        .scope-description {
            font-size: 14px;
            color: #6c757d;
            line-height: 1.4;
        }
        
        .scope-warning {
            font-size: 12px;
            color: #dc3545;
            margin-top: 4px;
            font-style: italic;
        }
        
        .disabled-scope {
            opacity: 0.5;
        }
        
        .disabled-scope .scope-checkbox {
            pointer-events: none;
        }
        
        .result-section {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .result-section h3 {
            margin-top: 0;
            color: #155724;
        }
        
        .scope-output {
            background: white;
            border: 1px solid #28a745;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
            margin: 10px 0;
        }
        
        .raps-tip {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        
        .raps-tip h3 {
            margin-top: 0;
            color: #1565c0;
        }
        
        .raps-tip code {
            background: #1565c0;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .preset-section {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .preset-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .preset-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }
        
        .copy-btn {
            background: #facc15;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px 0 0;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #eab308;
            transform: translateY(-1px);
        }
        
        .validation-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .compatibility-matrix {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .compatibility-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .compatibility-table th,
        .compatibility-table td {
            padding: 8px 12px;
            text-align: left;
            border: 1px solid #dee2e6;
        }
        
        .compatibility-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .api-supported {
            color: #28a745;
            font-weight: 600;
        }
        
        .api-limited {
            color: #ffc107;
            font-weight: 600;
        }
        
        .api-not-supported {
            color: #dc3545;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            .scope-categories {
                grid-template-columns: 1fr;
            }
            
            .auth-type-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .preset-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê APS OAuth Scope Builder</h1>
        <p class="subtitle">Build and validate Autodesk Platform Services OAuth scope combinations</p>
        
        <div class="raps-tip">
            <h3>üí° RAPS CLI Alternative</h3>
            <p>Instead of using this web tool, you can use RAPS CLI:</p>
            <p><code>raps auth login --scopes data:read,data:write,viewables:read</code></p>
            <p><code>raps auth status --scopes</code> - Check current scopes</p>
        </div>
        
        <!-- Authentication Type Selector -->
        <div class="auth-type-selector">
            <h3>üîë Select Authentication Type</h3>
            <p>Different OAuth flows support different scope combinations</p>
            <div class="auth-type-buttons">
                <div class="auth-btn active" onclick="setAuthType('2-legged')" data-type="2-legged">
                    2-Legged OAuth (Server-to-Server)
                </div>
                <div class="auth-btn" onclick="setAuthType('3-legged')" data-type="3-legged">
                    3-Legged OAuth (User Authorization)
                </div>
            </div>
        </div>
        
        <!-- Preset Configurations -->
        <div class="preset-section">
            <h3>üöÄ Quick Start Presets</h3>
            <p>Common scope combinations for typical use cases</p>
            <div class="preset-buttons">
                <button class="preset-btn" onclick="applyPreset('viewer')">3D Model Viewer</button>
                <button class="preset-btn" onclick="applyPreset('filemanager')">File Manager</button>
                <button class="preset-btn" onclick="applyPreset('automation')">Design Automation</button>
                <button class="preset-btn" onclick="applyPreset('bim360')">BIM 360/ACC Access</button>
                <button class="preset-btn" onclick="applyPreset('readonly')">Read-Only Access</button>
                <button class="preset-btn" onclick="applyPreset('maximum')">Maximum Permissions</button>
            </div>
        </div>
        
        <!-- Scope Categories -->
        <div class="scope-categories">
            <!-- Data Management Scopes -->
            <div class="scope-category">
                <h3>üìÅ Data Management</h3>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="data_read" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">data:read</div>
                        <div class="scope-description">Read files, folders, and projects from Data Management API</div>
                    </div>
                </div>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="data_write" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">data:write</div>
                        <div class="scope-description">Modify file metadata and properties</div>
                    </div>
                </div>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="data_create" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">data:create</div>
                        <div class="scope-description">Upload files and create folders</div>
                    </div>
                </div>
            </div>
            
            <!-- Object Storage Scopes -->
            <div class="scope-category">
                <h3>üóÑÔ∏è Object Storage (OSS)</h3>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="bucket_read" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">bucket:read</div>
                        <div class="scope-description">List and access Object Storage buckets</div>
                    </div>
                </div>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="bucket_create" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">bucket:create</div>
                        <div class="scope-description">Create new storage buckets</div>
                    </div>
                </div>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="bucket_delete" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">bucket:delete</div>
                        <div class="scope-description">Delete storage buckets</div>
                        <div class="scope-warning">‚ö†Ô∏è Use with caution</div>
                    </div>
                </div>
            </div>
            
            <!-- Model Derivative Scopes -->
            <div class="scope-category">
                <h3>üîÑ Model Derivative & Viewer</h3>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="viewables_read" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">viewables:read</div>
                        <div class="scope-description">Access translated models for 3D viewing</div>
                    </div>
                </div>
            </div>
            
            <!-- Design Automation Scopes -->
            <div class="scope-category">
                <h3>ü§ñ Design Automation</h3>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="code_all" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">code:all</div>
                        <div class="scope-description">Full access to Design Automation API (AutoCAD, Revit, etc.)</div>
                    </div>
                </div>
            </div>
            
            <!-- Account Management Scopes -->
            <div class="scope-category">
                <h3>üë• Account Management</h3>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="account_read" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">account:read</div>
                        <div class="scope-description">Read BIM 360/ACC account information</div>
                        <div class="scope-warning">3-legged OAuth only</div>
                    </div>
                </div>
                
                <div class="scope-item">
                    <input type="checkbox" class="scope-checkbox" id="account_write" onchange="updateScopes()">
                    <div class="scope-details">
                        <div class="scope-name">account:write</div>
                        <div class="scope-description">Modify BIM 360/ACC account settings</div>
                        <div class="scope-warning">3-legged OAuth only, admin privileges required</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="result-section">
            <h3>üéØ Generated Scope Configuration</h3>
            
            <p><strong>Space-separated scopes:</strong></p>
            <div class="scope-output" id="scopeOutput">No scopes selected</div>
            
            <p><strong>RAPS CLI command:</strong></p>
            <div class="scope-output" id="rapsCommand">raps auth login</div>
            
            <p><strong>cURL example:</strong></p>
            <div class="scope-output" id="curlCommand">Select scopes to generate command</div>
            
            <button class="copy-btn" onclick="copyScopes()">üìã Copy Scopes</button>
            <button class="copy-btn" onclick="copyRapsCommand()">üìã Copy RAPS Command</button>
            <button class="copy-btn" onclick="copyCurlCommand()">üìã Copy cURL Command</button>
        </div>
        
        <!-- Validation Information -->
        <div id="validationInfo" class="validation-info" style="display: none;">
            <h4>‚ö†Ô∏è Scope Validation</h4>
            <div id="validationMessages"></div>
        </div>
        
        <!-- API Compatibility Matrix -->
        <div class="compatibility-matrix">
            <h3>üìä API Compatibility Matrix</h3>
            <p>Which APIs you can access with your selected scopes:</p>
            <table class="compatibility-table">
                <thead>
                    <tr>
                        <th>API</th>
                        <th>Access Level</th>
                        <th>Required Scopes</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="compatibilityTableBody">
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentAuthType = '2-legged';
        let selectedScopes = new Set();

        const presets = {
            'viewer': ['data:read', 'viewables:read', 'bucket:read'],
            'filemanager': ['data:read', 'data:write', 'data:create', 'bucket:read', 'bucket:create'],
            'automation': ['code:all', 'bucket:read', 'bucket:create', 'data:read'],
            'bim360': ['account:read', 'data:read', 'data:write', 'data:create'],
            'readonly': ['data:read', 'bucket:read', 'viewables:read'],
            'maximum': ['data:read', 'data:write', 'data:create', 'bucket:read', 'bucket:create', 'bucket:delete', 'viewables:read', 'code:all', 'account:read', 'account:write']
        };

        const apiCompatibility = [
            {
                api: 'Data Management API',
                read: ['data:read'],
                write: ['data:read', 'data:write'],
                create: ['data:read', 'data:write', 'data:create'],
                notes: 'Core file and project management'
            },
            {
                api: 'Object Storage Service',
                read: ['bucket:read'],
                write: ['bucket:read', 'bucket:create'],
                create: ['bucket:read', 'bucket:create'],
                notes: 'Direct file storage'
            },
            {
                api: 'Model Derivative API',
                read: ['data:read', 'viewables:read'],
                write: ['data:read', 'viewables:read'],
                create: ['data:read', 'viewables:read'],
                notes: 'File translation and viewing'
            },
            {
                api: 'Design Automation API',
                read: ['code:all'],
                write: ['code:all'],
                create: ['code:all'],
                notes: 'CAD automation workflows'
            },
            {
                api: 'BIM 360/ACC API',
                read: ['account:read', 'data:read'],
                write: ['account:read', 'account:write', 'data:read', 'data:write'],
                create: ['account:read', 'account:write', 'data:read', 'data:write', 'data:create'],
                notes: '3-legged OAuth only'
            }
        ];

        function setAuthType(type) {
            currentAuthType = type;
            
            // Update button states
            document.querySelectorAll('.auth-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            // Update scope availability
            updateScopeAvailability();
            updateScopes();
        }

        function updateScopeAvailability() {
            const accountScopes = ['account_read', 'account_write'];
            
            accountScopes.forEach(scopeId => {
                const scopeItem = document.getElementById(scopeId).closest('.scope-item');
                
                if (currentAuthType === '2-legged') {
                    scopeItem.classList.add('disabled-scope');
                    document.getElementById(scopeId).checked = false;
                } else {
                    scopeItem.classList.remove('disabled-scope');
                }
            });
            
            selectedScopes.clear();
            document.querySelectorAll('.scope-checkbox:checked').forEach(checkbox => {
                if (!checkbox.closest('.scope-item').classList.contains('disabled-scope')) {
                    selectedScopes.add(checkbox.id.replace('_', ':'));
                }
            });
        }

        function applyPreset(presetName) {
            // Clear all checkboxes
            document.querySelectorAll('.scope-checkbox').forEach(cb => cb.checked = false);
            selectedScopes.clear();
            
            // Apply preset scopes
            const scopes = presets[presetName] || [];
            scopes.forEach(scope => {
                const scopeId = scope.replace(':', '_');
                const checkbox = document.getElementById(scopeId);
                const scopeItem = checkbox.closest('.scope-item');
                
                // Only check if not disabled for current auth type
                if (!scopeItem.classList.contains('disabled-scope')) {
                    checkbox.checked = true;
                    selectedScopes.add(scope);
                }
            });
            
            updateScopes();
        }

        function updateScopes() {
            // Collect selected scopes
            selectedScopes.clear();
            document.querySelectorAll('.scope-checkbox:checked').forEach(checkbox => {
                const scopeItem = checkbox.closest('.scope-item');
                if (!scopeItem.classList.contains('disabled-scope')) {
                    selectedScopes.add(checkbox.id.replace('_', ':'));
                }
            });
            
            const scopesArray = Array.from(selectedScopes);
            const scopesString = scopesArray.join(' ');
            
            // Update output displays
            document.getElementById('scopeOutput').textContent = 
                scopesString || 'No scopes selected';
            
            const authFlag = currentAuthType === '3-legged' ? '--3legged ' : '';
            const scopesFlag = scopesArray.length > 0 ? `--scopes ${scopesString}` : '';
            document.getElementById('rapsCommand').textContent = 
                `raps auth login ${authFlag}${scopesFlag}`.trim();
            
            // Update cURL command
            updateCurlCommand(scopesString);
            
            // Update validation
            validateScopes();
            
            // Update compatibility matrix
            updateCompatibilityMatrix();
        }

        function updateCurlCommand(scopesString) {
            if (!scopesString) {
                document.getElementById('curlCommand').textContent = 'Select scopes to generate command';
                return;
            }
            
            const grantType = currentAuthType === '2-legged' ? 'client_credentials' : 'authorization_code';
            
            if (currentAuthType === '2-legged') {
                document.getElementById('curlCommand').textContent = 
                    `curl -X POST "https://developer.api.autodesk.com/authentication/v2/token" \\
  -H "Content-Type: application/x-www-form-urlencoded" \\
  -d "client_id=$APS_CLIENT_ID&client_secret=$APS_CLIENT_SECRET&grant_type=${grantType}&scope=${scopesString}"`;
            } else {
                document.getElementById('curlCommand').textContent = 
                    `# Step 1: Get authorization code
curl "https://developer.api.autodesk.com/authentication/v2/authorize?response_type=code&client_id=$APS_CLIENT_ID&redirect_uri=$APS_CALLBACK_URL&scope=${encodeURIComponent(scopesString)}"

# Step 2: Exchange code for token
curl -X POST "https://developer.api.autodesk.com/authentication/v2/token" \\
  -H "Content-Type: application/x-www-form-urlencoded" \\
  -d "client_id=$APS_CLIENT_ID&client_secret=$APS_CLIENT_SECRET&grant_type=authorization_code&code=$AUTHORIZATION_CODE&redirect_uri=$APS_CALLBACK_URL"`;
            }
        }

        function validateScopes() {
            const validationDiv = document.getElementById('validationInfo');
            const messagesDiv = document.getElementById('validationMessages');
            let messages = [];
            
            // Check for common issues
            if (selectedScopes.has('data:write') && !selectedScopes.has('data:read')) {
                messages.push('‚ö†Ô∏è data:write usually requires data:read');
            }
            
            if (selectedScopes.has('data:create') && !selectedScopes.has('data:read')) {
                messages.push('‚ö†Ô∏è data:create usually requires data:read');
            }
            
            if (selectedScopes.has('bucket:create') && !selectedScopes.has('bucket:read')) {
                messages.push('‚ö†Ô∏è bucket:create usually requires bucket:read');
            }
            
            if (selectedScopes.has('viewables:read') && !selectedScopes.has('data:read')) {
                messages.push('‚ÑπÔ∏è viewables:read typically used with data:read for file access');
            }
            
            if (selectedScopes.has('account:write') && !selectedScopes.has('account:read')) {
                messages.push('‚ö†Ô∏è account:write usually requires account:read');
            }
            
            if (currentAuthType === '2-legged' && (selectedScopes.has('account:read') || selectedScopes.has('account:write'))) {
                messages.push('‚ùå Account scopes only work with 3-legged OAuth');
            }
            
            if (messages.length > 0) {
                messagesDiv.innerHTML = messages.map(msg => `<p>${msg}</p>`).join('');
                validationDiv.style.display = 'block';
            } else {
                validationDiv.style.display = 'none';
            }
        }

        function updateCompatibilityMatrix() {
            const tbody = document.getElementById('compatibilityTableBody');
            tbody.innerHTML = '';
            
            apiCompatibility.forEach(api => {
                const row = tbody.insertRow();
                
                // API name
                row.insertCell().textContent = api.api;
                
                // Check access level
                let accessLevel = 'None';
                let accessClass = 'api-not-supported';
                
                if (hasAllScopes(api.create)) {
                    accessLevel = 'Full (Create/Read/Write)';
                    accessClass = 'api-supported';
                } else if (hasAllScopes(api.write)) {
                    accessLevel = 'Write & Read';
                    accessClass = 'api-supported';
                } else if (hasAllScopes(api.read)) {
                    accessLevel = 'Read Only';
                    accessClass = 'api-limited';
                }
                
                const accessCell = row.insertCell();
                accessCell.textContent = accessLevel;
                accessCell.className = accessClass;
                
                // Required scopes
                const requiredScopes = api.create.join(', ');
                row.insertCell().textContent = requiredScopes;
                
                // Notes
                row.insertCell().textContent = api.notes;
            });
        }

        function hasAllScopes(requiredScopes) {
            return requiredScopes.every(scope => selectedScopes.has(scope));
        }

        function copyScopes() {
            const scopesString = Array.from(selectedScopes).join(' ');
            copyToClipboard(scopesString || 'No scopes selected', 'Scopes copied to clipboard!');
        }

        function copyRapsCommand() {
            const command = document.getElementById('rapsCommand').textContent;
            copyToClipboard(command, 'RAPS command copied to clipboard!');
        }

        function copyCurlCommand() {
            const command = document.getElementById('curlCommand').textContent;
            copyToClipboard(command, 'cURL command copied to clipboard!');
        }

        function copyToClipboard(text, message) {
            navigator.clipboard.writeText(text).then(() => {
                alert(message);
            }).catch(err => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert(message);
            });
        }

        // Initialize
        updateScopeAvailability();
        updateCompatibilityMatrix();
        
        // Apply default preset
        applyPreset('viewer');
    </script>
</body>
</html>